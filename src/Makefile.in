#DEBUG =		-g
OPT =		-O3 -funroll-loops

# GIRS server (amberfishd) is experimental and not compiled by default.
GIRS =		/usr/local/girtools/girs

LARGEFILE =	-D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64
CXXFLAGS =	@CPPFLAGS@ -Wall -Wno-unused-variable \
			${DEBUG} ${OPT} ${LARGEFILE} -I${GIRS}/src
SHELL =		/bin/sh
CXX =		g++

LIBS =		@LDFLAGS@ @LIBS@ -L. -lamberfish -lm

LIBAMBERFISH =	libamberfish.a
OBJ =		engine.o text.o xml.o xml_test.o syr1.o
SRC =		admin.cc docbuf.cc engine.cc explain.cc fdef.cc \
		index.cc lock.cc log.cc open.cc search.cc util.cc \
		afadmin.cc affetch.cc afindex.cc afsearch.cc \
		syr1.cc text.cc xml.cc xml_test.cc

all: afindex afsearch afadmin affetch

depend: version.h
	${CXX} -MM ${SRC} > makefile.depend

include makefile.depend

afindex: ${LIBAMBERFISH} afindex.o
	${CXX} -o afindex afindex.o ${LIBS}

afsearch: ${LIBAMBERFISH} afsearch.o
	${CXX} -o afsearch afsearch.o ${LIBS}

afadmin: ${LIBAMBERFISH} afadmin.o
	${CXX} -o afadmin afadmin.o ${LIBS}

affetch: affetch.o
	${CXX} -o affetch affetch.o

amberfishd: ${LIBAMBERFISH} amberfishd.o
	${CXX} -o amberfishd amberfishd.o ${LIBS} \
		-L${GIRS}/src -lgirs

${LIBAMBERFISH}: ${OBJ}
	ar rs ${LIBAMBERFISH} ${OBJ}

version.h:
	echo "#define ETYMON_AF_VERSION \"`cat ../VERSION`\"" > version.h

clean:
	rm -f afindex afsearch afadmin affetch amberfishd \
		afindex.o afsearch.o afadmin.o affetch.o amberfishd.o \
		${OBJ} ${LIBAMBERFISH} version.h

distclean:
	make clean
	rm -f *~ *#
